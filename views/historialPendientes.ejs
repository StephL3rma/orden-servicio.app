<%-include("./partials/header.ejs", { mostrarBoton3:true })%>

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2><i class="bi bi-person-badge"></i> Técnico: <span style="color: #0a7ea4;"><%=usuario%></span></h2>
        </div>
    </div>

    <!-- Tabs para Abiertas/Completadas -->
    <ul class="nav nav-tabs mb-3" id="ordenesTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="abiertas-tab" data-bs-toggle="tab" data-bs-target="#abiertas" type="button">
                <i class="bi bi-hourglass-split"></i> Órdenes Abiertas
                <span class="badge bg-warning text-dark"><%= totalAbiertas %></span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="completadas-tab" data-bs-toggle="tab" data-bs-target="#completadas" type="button">
                <i class="bi bi-check-circle"></i> Órdenes Completadas
                <span class="badge bg-success"><%= totalCompletadas %></span>
            </button>
        </li>
    </ul>

    <div class="tab-content" id="ordenesTabContent">
        <!-- Tab Órdenes Abiertas -->
        <div class="tab-pane fade show active" id="abiertas">
            <% if (totalAbiertas === 0) { %>
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No tienes órdenes abiertas asignadas.
                </div>
            <% } else { %>
                <table class="table table-hover">
                    <thead class="table-primary">
                        <tr>
                            <th>Fecha</th>
                            <th>Folio</th>
                            <th>Cliente</th>
                            <th>Estado</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% historialAbiertas.forEach(orden => { %>
                            <tr>
                                <td><%= orden.create_at %></td>
                                <td><strong>#<%= orden.id %></strong></td>
                                <td><%= orden.nombre %></td>
                                <td><span class="badge bg-warning text-dark"><%= orden.estado %></span></td>
                                <td>
                                    <form action="seguimiento" method="post" style="display:inline;">
                                        <input type="hidden" name="usuario" value="<%=usuario%>">
                                        <button name="seguimiento" value='<%= JSON.stringify(orden) %>' class="btn btn-sm btn-primary">
                                            <i class="bi bi-play-circle"></i> Trabajar
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } %>
        </div>

        <!-- Tab Órdenes Completadas -->
        <div class="tab-pane fade" id="completadas">
            <% if (totalCompletadas === 0) { %>
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> Aún no has completado ninguna orden.
                </div>
            <% } else { %>
                <table class="table table-hover">
                    <thead class="table-success">
                        <tr>
                            <th>Fecha Creación</th>
                            <th>Fecha Cierre</th>
                            <th>Folio</th>
                            <th>Cliente</th>
                            <th>Estado</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% historialCompletadas.forEach(orden => { %>
                            <tr>
                                <td><%= orden.create_at %></td>
                                <td><%= orden.fecha_servicio || 'N/A' %></td>
                                <td><strong>#<%= orden.id %></strong></td>
                                <td><%= orden.nombre %></td>
                                <td><span class="badge bg-success"><%= orden.estado %></span></td>
                                <td>
                                    <a href="/orden/<%= orden.id %>" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> Ver
                                    </a>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            <% } %>
        </div>
    </div>
</div>

<%-include("./partials/footer.ejs")%>