<%-include('./partials/header.ejs', { mostrarBoton3: false }) %>

      <p class="lead">Orden de servicio Grupo Estrella</p>
    </div>

    <div class="py-5"> 
      
      <div class="col-md-10 col-lg-12" style="margin-left: 20px" style="margin-right: 30px;">
        <h4 class="mb-3">Direccion de servicio</h4>

       
         

         
          <div class="col-md-4">
              <label for="state" class="form-label">Direcciones</label>
              <%let sizeSelectedUnos=sizeSelectedUno;%>
              <% console.log("numero de direcciones",sizeSelectedUnos);%>
          <% for(let i=0; i < sizeSelectedUnos; i++){%>
             <form action="direccionSele" method="post">
               <input type="hidden" name="nuevoCliente" value=" <%= nuevoCliente %>">
               <%= console.log("envio cliente actual",nuevoCliente);%>
              <input type="hidden" name="botonMaster" value="<%= arrayClienteSelected[i].id %>">
              <%= console.log("ID direccion cliente actual es: ",arrayClienteSelected[i].id);%>
              <input type="hidden" name="opcionPresionada" value="<%= i %>">
              <%= console.log("opcion Presionada en clienteHabitual es: ", i);%>

               <button class="w-100 btn btn-outline-primary btn-sm" style="text-align: left;" type="submit" >Colonia: <%= arrayClienteSelected[i].colonia_localidad %></button>
              </form>
          <% }%>

          <!-- Botón agregar nueva dirección -->
          <button class="w-100 btn btn-outline-success btn-sm mt-2" type="button" onclick="limpiarParaNuevaDireccion()">
            <i class="bi bi-plus-circle"></i> Nueva Dirección
          </button>

            </div>
        


        <h4 class="py-5 text-center">Cliente Actual: </h4>
        <form id="formPrincipal" action="guardarOrdenHabitual" method="post">


          


          <div class="row g-3">
            <div class="col-12">
              <label for="nombreCliente" class="form-label">Nombre del Cliente</label>
              <input type="text" class="form-control" name="nombreCliente" value="<%= arrayClienteSelected[0].nombre%>" required> <!--oninvalid="this.setCustomValidity('Este campo es requerido')"  no permite rellenar el campo una vez el error sale-->
            </div>
            <div class="col-12">
              <label for="idCliente" class="form-label" style="color: #14a396;">Id de Cliente: <%= nuevoCliente %></label>
              <input type="hidden" class="form-control" name="idCliente" value="<%= nuevoCliente %>">
            </div>
            <div class="col-12">
                <label for="correo" class="form-label">Correo Electrónico</label>
                <input type="email" class="form-control" name="correo" value="<%= arrayClienteSelected[0].email %>">
              </div>

            <div class="col-12">
                <label for="RFC" class="form-label">RFC</label>
                <input type="text" class="form-control" name="rfc" value="<%= arrayClienteSelected[0].rfc %>">
              </div>
          
            <div class="col-sm-6">
              <label for="calle" class="form-label">Calle/número</label>
              <input type="text" class="form-control" name="calle" value="<%= arrayClienteSelected[0].calle_num_ext %>">
            </div>
          
            <div class="col-sm-6">
              <label for="numeroInterior" class="form-label">Número interior</label>
              <input type="text" class="form-control" name="numeroInterior" value="<%= arrayClienteSelected[0].no_int %>">
            </div>
          
            <div class="col-12">
              <label for="Colonia" class="form-label">Colonia/Localidad</label>
              <input type="text" class="form-control" name="Colonia" value="<%= arrayClienteSelected[0].colonia_localidad%>">
            </div>
          
            <div class="col-md-3">
              <label for="cPostal" class="form-label">Código Postal</label>
              <input type="text" class="form-control" name="cPostal" value="<%= arrayClienteSelected[0].codigo_postal %>">
            </div>
         
            <div class="col-md-3">
              <label for="telefono" class="form-label">Teléfono</label>
              <input type="text" class="form-control" name="telefono" value="<%= arrayClienteSelected[0].telefono %>" required>
            </div>
          
            <div class="col-md-4">
              <label for="ciudad" class="form-label">Ciudad</label>
              <select class="form-select" name="ciudad" value="<%= arrayClienteSelected[0].ciudad %>">
                <option value="" style="color: #999;"><%= arrayClienteSelected[0].ciudad %></option>
                <%-include('./partials/estados.ejs') %>
              </select>
            </div>
          
            <div class="col-12">
              <label for="zip" class="form-label">Referencia de dirección</label>
              <input type="text" class="form-control" name="referencia" value="<%= arrayClienteSelected[0].referencia_dir %>">
            </div>
            <div class="col-12">
                <label for="zip" class="form-label">Referencia de Servicio</label>
                <input type="text" class="form-control" name="referencia">
              </div>
          </div>
        
          <hr class="my-4">
        
          <div class="row g-3">
            <div class="col-sm-3">
              <label for="folio" class="form-label">Folio: <%= nuevoFolio %></label>
              <input type="hidden" id="valorLabel" name="nuevoFolio" value="<%= nuevoFolio %>">
            </div>
            <div class="col-sm-3">
              <label for="fecha" class="form-label">Fecha: <%= hoy %></label>
              <input type="hidden" id="valorLabel" name="valorLabel" value="<%= hoy %>">
            </div>
            <div class="col-sm-3">
              <label for="fecha" class="form-label">Estado: Abierto</label>
              <input type="hidden" id="valorLabel" name="estado" value="Abierto">
            </div>
            <div class="col-sm-3">
              <label class="form-label">Técnico Asignado</label>
              <select class="form-select" name="tecnicoAsignado" required>
                <option value="">Seleccionar técnico</option>
                <% tecnicos.forEach(tecnico => { %>
                  <option value="<%= tecnico.id %>"><%= tecnico.username %></option>
                <% }); %>
              </select>
            </div>
          </div>

          <hr class="my-4">
          <h4 class="mb-3">Información técnica (opcional)</h4>
          <p class="text-muted">Estos campos son opcionales. El técnico podrá completarlos después.</p>

          <div class="row g-3">
            <div class="col-12">
              <label class="form-label">Tipo de servicio</label>
              <div class="checkbox mb-3">
                <label>
                  <input type="checkbox" name="checkBox[]" value="1"> Recolección<br>
                  <input type="checkbox" name="checkBox[]" value="2"> Diagnóstico<br>
                  <input type="checkbox" name="checkBox[]" value="3"> Mantenimiento<br>
                  <input type="checkbox" name="checkBox[]" value="4"> Puesta en marcha<br>
                  <input type="checkbox" name="checkBox[]" value="5"> Reparación<br>
                  <input type="checkbox" name="checkBox[]" value="6"> Instalación<br>
                  <input type="checkbox" name="checkBox[]" value="7"> Otro<br>
                </label>
              </div>
            </div>

            <div class="col-md-4">
              <label class="form-label">Tipo de Equipo</label>
              <select class="form-select" name="tipo">
                <option value="">Selecciona una opción</option>
                <option value="1">Centro de Lavado</option>
                <option value="2">Centro de Secado</option>
                <option value="3">Lavadora</option>
                <option value="4">Secadora</option>
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label">Marca</label>
              <select class="form-select" name="marca">
                <option value="">Selecciona una opción</option>
                <option value="1">ADC</option>
                <option value="2">DANUBE</option>
                <option value="3">LG</option>
                <option value="4">MAYTAG</option>
              </select>
            </div>

            <div class="col-md-3">
              <label class="form-label">Modelo</label>
              <input type="text" class="form-control" name="modelo">
            </div>

            <div class="col-md-3">
              <label class="form-label">Número de serie</label>
              <input type="text" class="form-control" name="serie">
            </div>

            <div class="col-md-3">
              <label class="form-label">Voltaje</label>
              <input type="number" step="any" class="form-control" name="voltaje">
            </div>

            <div class="col-md-3">
              <label class="form-label">Amperaje</label>
              <input type="number" step="any" class="form-control" name="amperaje">
            </div>

            <div class="col-md-3">
              <label class="form-label">Watts</label>
              <input type="number" step="any" class="form-control" name="watts">
            </div>

            <div class="col-md-3">
              <label class="form-label">Presión de agua</label>
              <input type="number" step="any" class="form-control" name="presion">
            </div>

            <div class="col-12">
              <label class="form-label">Falla reportada</label>
              <input type="text" class="form-control" name="fallaReportada">
            </div>
          </div>

          <br>
          <input type="hidden" name="accion" id="accionInput" value="orden">
          <button class="w-100 btn btn-success btn-lg mb-2" type="button" onclick="guardarSoloDireccion()" id="btnSoloDireccion" style="display:none;">
            <i class="bi bi-geo-alt"></i> Guardar Solo Dirección
          </button>
          <button class="w-100 btn btn-primary btn-lg" type="submit" id="btnGuardarOrden">Guardar Orden</button>
        </form>

        <script>
          function limpiarParaNuevaDireccion() {
            // Limpiar solo campos de dirección (cliente NO se modifica)
            document.querySelector('input[name="calle"]').value = '';
            document.querySelector('input[name="numeroInterior"]').value = '';
            document.querySelector('input[name="Colonia"]').value = '';
            document.querySelector('input[name="cPostal"]').value = '';
            document.querySelector('input[name="telefono"]').value = '';
            document.querySelector('input[name="referencia"]').value = '';

            // Resaltar campos de dirección que se pueden llenar
            document.querySelector('input[name="calle"]').style.backgroundColor = '#d1ecf1';
            document.querySelector('input[name="Colonia"]').style.backgroundColor = '#d1ecf1';

            // Mostrar botón de guardar solo dirección
            document.getElementById('btnSoloDireccion').style.display = 'block';
            document.getElementById('btnGuardarOrden').textContent = 'Guardar Orden Completa';

            // Scroll al formulario
            document.getElementById('formPrincipal').scrollIntoView({ behavior: 'smooth' });
          }

          function guardarSoloDireccion() {
            const form = document.getElementById('formPrincipal');
            document.getElementById('accionInput').value = 'direccion';
            form.action = 'agregarDireccion';
            form.submit();
          }
        </script>
      </div>
    </div>
  </main>

  <%-include('./partials/footer.ejs') %>